# 07-final-verdict.md

## Итоговый senior-вердикт

### Ключевые архитектурные риски (TOP-5)

1.  **Отсутствие Domain-слоя и рассредоточенная бизнес-логика:** Ключевые бизнес-правила смешаны с UI-компонентами, API-запросами и сторами. Это является фундаментальным риском для масштабируемости, поддерживаемости и долгосрочного развития, особенно для production-grade проекта.
2.  **Тесная связанность с BaaS-провайдерами и сложность замены API:** Прямое использование SDK Supabase в `queryFn` и зависимость от специфичных конфигураций Appwrite создают высокую связанность. Замена или миграция BaaS-провайдера потребует значительных переписываний.
3.  **Императивный код и прямое манипулирование DOM в хуках (`useResizable`):** Хук `useResizable` использует прямое манипулирование DOM и глобальными стилями, что противоречит декларативному подходу React. Это усложняет тестирование, интеграцию и может вызвать проблемы с SSR.
4.  **Смешение ответственности в компонентах и хуках:** Такие элементы, как `IssueItem.tsx`, `useCanGoForward`, и некоторые сторы, несут слишком много ответственности (UI, управление состоянием, API-запросы, сложная навигационная логика), что снижает их переиспользуемость, предсказуемость и усложняет поддержку.
5.  **Наличие технического долга и неоднозначность API-слоя:** Директория `src/api/wow/` с экспериментальным кодом, закомментированный код, а также некоторая непоследовательность в именовании и структуре API-слоя создают путаницу, увеличивают технический долг и снижают общую предсказуемость кодовой базы.

### Что обязательно переписать в первую очередь

1.  **Абстракция API-слоя:** Создать отдельный слой (например, Repository Pattern или Service Layer) для инкапсуляции логики взаимодействия с BaaS-провайдерами. Это позволит изолировать бизнес-логику от деталей реализации SDK Supabase/Appwrite и облегчит их замену.
2.  **Внедрение Domain-слоя:** Вынести ключевую бизнес-логику (валидация, правила трансформации данных, бизнес-процессы) в независимые модули, которые не зависят от UI или инфраструктуры.
3.  **Рефакторинг `useResizable`:** Переписать хук `useResizable` для использования декларативных подходов React (управление стилями через `ref`, более безопасная обработка событий).
4.  **Очистка и стандартизация `src/api/`:** Удалить экспериментальный код (`src/api/wow/`), стандартизировать именование и структуру, устранить неоднозначность.

### Что можно оставить как есть (с оговорками)

*   **Большинство UI-компонентов:** Основная часть компонентов (например, `Header.tsx`, `ActionBar.tsx`, `StatusSelect`, `LabelSelect` и т.д.) выполняют свою роль и могут остаться без изменений, если не будут непосредственно затрагиваться при рефакторинге.
*   **Zustand Stores:** Сторы (`selection.store.tsx`, `habits.store.tsx`, `modals.store.tsx`) могут быть оставлены, если их ответственность остается сфокусированной на управлении состоянием и не разрастается до бизнес-логики. Необходимо следить за этим.
*   **TanStack Router:** Использование TanStack Router является современным решением. Следует избегать переизобретения логики навигации (как в `useCanGoForward`) и использовать встроенные возможности библиотеки.
*   **Chakra UI:** Библиотека компонентов хорошо интегрирована и обеспечивает консистентный UI.
*   **TypeScript & Vite:** Основной стек сборки и типизации является стандартом и не требует замены.

### Субъективная оценка зрелости кода

**Mixed (Смешанная)**

Проект демонстрирует черты как зрелой разработки (современный стек, использование TanStack Query, TypeScript, Biome, хорошая структура фич), так и ранних стадий или наличия технического долга (отсутствие Domain-слоя, тесная связанность с BaaS, императивный код в хуках, экспериментальный код, смешение ответственности).

### Краткий roadmap улучшений (без конкретных реализаций)

1.  **Фаза 1: Инфраструктура и Базовая Архитектура**
    *   Реализовать слой абстракции API (Service/Repository Layer) для изоляции BaaS-SDK.
    *   Удалить технический долг: экспериментальный код, закомментированный код, неоднозначные файлы.
    *   Рефакторинг `useResizable`.
    *   Пересмотреть и упростить хуки, связанные с навигацией (`useCanGoForward`).

2.  **Фаза 2: Выделение Бизнес-логики**
    *   Внедрить Domain-слой: определить сущности, правила и бизнес-процессы.
    *   Перенести бизнес-логику из UI-компонентов, API-файлов и сторов в Domain-слой.
    *   Пересмотреть компоненты (`IssueItem.tsx`) для уменьшения смешения ответственности.

3.  **Фаза 3: Оптимизация и Полировка**
    *   Оптимизировать запросы к API (устранить избыточные запросы, например, `useGetProjects` в `IssueItem`).
    *   Провести ревизию сторов, убедиться в их чистоте и сфокусированности.
    *   Улучшить обработку implicit contracts.
    *   Добавить или улучшить юнит-тесты для Domain-слоя и критически важных сервисов.
