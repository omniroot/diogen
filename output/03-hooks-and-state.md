# 03-hooks-and-state.md

## Анализ Hooks и state management

### 1. Пользовательские хуки (`Custom Hooks`)

*   **`useCanGoForward.tsx`:**
    *   **Проблема:** Реализует сложную логику управления историей навигации вручную через `useState`/`useEffect`, дублируя функциональность `TanStack Router` (`history.back()`, `history.forward()`, `useCanGoBack()`). Это делает хук хрупким, сложным для поддержки и тестирования, а также нарушает принцип DRY.
    *   **Аргументация:** Переизобретение колеса для уже существующей функциональности фреймворка.
    *   **Последствия:** Снижение предсказуемости навигации, увеличение тех. долга.
    *   **Нарушенный принцип:** DRY, KISS, Leverage existing libraries.

*   **`useMedia.tsx`:**
    *   **Проблема:** Является оберткой над `useMediaQuery` из Chakra UI. Хотя и упрощает использование, может считаться избыточной абстракцией.
    *   **Аргументация:** Можно было бы использовать `useMediaQuery` напрямую, или сделать абстракцию более явной.
    *   **Последствия:** Незначительное усложнение кода.
    *   **Нарушенный принцип:** Principle of Least Abstraction.

*   **`useResizable.tsx`:**
    *   **Проблема:** Прямая манипуляция DOM (`container.style`, `document.body.style`), ручное управление событиями (`window.addEventListener`) и создание DOM-элементов (`<svg>`) внутри хука.
    *   **Аргументация:** Нарушает декларативный подход React, является антипаттерном, усложняет тестирование и интеграцию, потенциально вызывает проблемы с SSR.
    *   **Последствия:** Снижение переиспользуемости, хрупкость, сложности в поддержке.
    *   **Нарушенный принцип:** Declarative Programming, Encapsulation, Separation of Concerns.

### 2. State Management (Zustand Stores)

*   **`selection.store.tsx`:**
    *   **Проблема:** Управляет состоянием выделенных элементов. Может потенциально разрастись и начать содержать бизнес-логику, нарушая SRP.
    *   **Аргументация:** Стор является критически важным для UI, его разрастание может привести к "god-store".
    *   **Последствия:** Сложность поддержки, потенциальное смешение ответственности.
    *   **Нарушенный принцип:** Potential for violating SRP.

*   **`modals.store.tsx`:**
    *   **Проблема:** Управляет видимостью модальных окон. Стандартный и эффективный подход.
    *   **Аргументация:** Не выявлено проблем, если логика модальных окон вынесена в их компоненты.
    *   **Последствия:** Нет.

*   **`header.store.tsx`:**
    *   **Проблема:** Управляет состоянием бокового меню заголовка. Простой и сфокусированный.
    *   **Аргументация:** Соответствует своей задаче.
    *   **Последствия:** Нет.

*   **`location.store.tsx` (предположительно):**
    *   **Проблема:** Если существует, может дублировать функциональность `TanStack Router` или содержать бизнес-логику, не связанную с UI-состоянием.
    *   **Аргументация:** Необходимо убедиться, что он не дублирует навигационную логику.
    *   **Последствия:** Нарушение DRY, потенциальное смешение состояний.

*   **`habits.store.tsx` (предположительно):**
    *   **Проблема:** Может содержать бизнес-логику, связанную с привычками, вместо чистого управления состоянием.
    *   **Аргументация:** Следует выносить сложную логику за пределы стора.
    *   **Последствия:** Потенциальное нарушение SRP, сложности в тестировании.

### 3. Тестопригодность

*   **Сложность:** Хуки, манипулирующие DOM (`useResizable`), использующие глобальные объекты (`window`, `document`) или сложную логику (`useCanGoForward`), трудно тестировать.
*   **Рекомендация:** Логика, не зависящая от React-рендеринга, должна быть вынесена в чистые JS-функции.

### 4. Утечки инфраструктуры в UI

*   **`useCanGoForward`:** Косвенно зависит от инфраструктуры навигации (`TanStack Router`).
*   **`useResizable`:** Прямая манипуляция `document.body.style` является утечкой инфраструктуры (глобальное состояние документа).
*   **Zustand Stores:** Потенциально, если хранят сырые API-данные или специфичную инфраструктурную логику.

### Общие рекомендации:

*   Упростить или удалить `useCanGoForward`.
*   Рефакторить `useResizable` для декларативного подхода.
*   Поддерживать чистоту сторов Zustand, вынося сложную логику.
*   Проверить `location.store.tsx` и `habits.store.tsx` на предмет дублирования или смешения ответственности.
